```{r}
#| label: setup
#| include: false

# Improve digit display and NA display for kable tables
options(scipen = 1, knitr.kable.NA = "")

# Load necessary packages
library(tidyverse)
library(knitr)
library(kableExtra)

# for text analysis
library(tidytext)
library(tidyverse)
```

# What's engagement and sentiment like across subreddits?


```{r}
#| fig-align: center
#| out-width: 30%
#| out-height: 50px
#| layout: [[1,1,1]]
 
 include_graphics("https://i.imgur.com/WydIOUS.png") # Amherst icon
  include_graphics("https://i.imgur.com/0Au7pMT.png") # Middlebury icon
 include_graphics("https://i.imgur.com/FA3VX3Y.png") # Williams icon


```
 

```{r}
#| label: anova-results
#| tbl-cap: "ANOVA report: subreddit sentiment & engagement"
#| tbl-subcap:
#|   - "Summary statistics for cross subreddit comparison"
#|   - "ANOVA: average sentiment across subreddit"
#|   - "ANOVA: average comments across subreddit"
#| layout: [[1], [4, -1, 4]] 


load('./data/subreddit_summaries.Rdata')
load('./data/aov_tukey_results.Rdata')

subreddit_summaries |>
  kable(digits=2, 
        col.names = c('Subreddit', 'Post Count','Score (tot)', 
                      'Comments (tot)', 'Score (avg)', 'Comments (avg)')) |>
  row_spec(1, background = "#b7a5d3", color = 'white') |>
  row_spec(2, background = "#37538C", color='white') |>
  row_spec(3, background = "#FFBE0A", color = 'white')

aov_sent_res |> 
  kable(col.names = c('Factor', 'df', 'SSQ','MSQ', 'F', 'p'), digits=2)

aov_comments_res |> 
  kable(col.names = c('Factor', 'df', 'SSQ','MSQ', 'F', 'p'), digits=2) 
```

Let's compare the subreddits! The first @anova-results above shows the summary statistics for each subreddit. The values were found by grouping the original dataset by subreddit and calculating sums and averages of post count, comment count, and sentiment score. If you want to explore the data further check out the full dataset [here](index.qmd#fig-raw-data). The total post counts were comparable, which is what we expected given their similar ages. For sentiment, Middlebury clearly stands out as more negative (2.95/post) compared to Amherst (5.26) and Williams (4.81). Amherst and Williams also tend to have higher engagement: 4.40 and 6.28 respectively relative to Midd (2.36). These numbers are fun to compare, but, to assess the statistical significance of these potential differences, you have to go a few steps further.

We fit a two one way ANOVA models to our dataset, one to test for statiscially significant differences between the average sentiment score of each subreddit, and one to compare the average comment counts per post. The results, see TABLE, indicated there was a least one pairwise difference between subreddit post sentiment average (p < 0.001) and comment count (p < 0.001). For more information about what an analysis of variance is doing under the hood, a good reference is provided by @ANOVA. The logical follow up was to conduct a post-hoc Tukey's Honestly Significant Difference (HSD), which assess differences between each pair of subreddit means. 

```{r}
#| label: tukey-results
#| tbl-cap: "Tukey's HSD: Pairwise differences across subreddits"
#| layout: [[1, -1, 1]] 


tukey_sent |>
  select(-term, -null.value) |>
  kable(digits=2, 
        col.names = c('Subreddit Pair', 'est', 'low','high', 'p'),
        caption="Tukey's HSD: subreddit sentiment") |>
  row_spec(1, background = "#b7a5d3", color = 'white') |>
  row_spec(3, background = "#FFBE0A", color = 'white')



tukey_comments |> 
  select(-term, -null.value) |>
  kable(col.names = c('Subreddit Pair', 'est', 'low','high', 'p'), 
        caption = "Tukey's HSD: subreddit comment count",
        digits=2) |>
   row_spec(1, background = "#b7a5d3", color = 'white') |>
   row_spec(2, background = "#FFBE0A", color = 'white') |>
   row_spec(3, background = "#FFBE0A", color = 'white')
  
  

```

The results, see TABLE, were conclusive! Each row in the table above holds the results of a Tukey's HSD comparison between two college subreddits; we colored each row by the college that, according to the test, was deemed to have a significantly higher average (purple for Amherst, gold for Williams, and white for a 'tie'). Both Amherst (p < 0.001) and Williams (p < 0.001) held a significantly higher average sentiment score per post over Middlebury. Notably, Amherst and Williams did not differ signifcantly by this same metric (p = 0.56). As far as engagement goes, Amherst (p < 0.001) and Williams (p < 0.001) yet again out-performed Middlebury in average comments per post, while Williams convincingly exceeded the mean of Amherst as well (p < 0.001). Again, for more information on the gritty details involved in performing Tukey's HSD, see this valuable resource, which was helpful for the work present here: @Tukey. Unfortunately gold holds the majority of victories in these pairwise comparisons, and Williams emerges as the champion of this competition by tying Amherst in post positivity and edging us in post engagement. We wish we could fudge the numbers but that would be statistical malpractice.